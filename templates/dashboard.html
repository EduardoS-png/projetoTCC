{% extends 'layout.html' %} {% block main %}
<section id="dashboard">
  <div class="cabecalhoPagina">
    <h2 class="paginaTitulo">Dashboard</h2>
    <p class="subtitulo">Visão geral das operações e indicadores principais</p>
  </div>

  <div class="dashboardGrid">
    <!-- Compras Hoje -->
    <div class="cartao">
      <div class="cabecalhoCartao">
        <h3 class="tituloCartao">Compras Hoje</h3>
        <div class="iconeCartao">
          <img
            src="{{ url_for('static', filename='assets/icons/vendas.svg') }}"
            alt="compras"
          />
        </div>
      </div>
      <div class="valorCartao">
        R$ {{ '{:,.2f}'.format(total_compras_hoje) }}
      </div>
      <div class="descricaoCartao">Total de compras realizadas hoje</div>
    </div>

    <!-- Valor Total em Estoque -->
    <div class="cartao">
      <div class="cabecalhoCartao">
        <h3 class="tituloCartao">
          Valor Total <br />
          em Estoque
        </h3>
        <div class="iconeCartao">
          <img
            src="{{ url_for('static', filename='assets/icons/estoque.svg') }}"
            alt="estoque"
          />
        </div>
      </div>
      <div class="valorCartao">
        R$ {{ '{:,.2f}'.format(valor_estoque_total) }}
      </div>
      <div class="descricaoCartao">Capital imobilizado no estoque</div>
    </div>

    <!-- Produtos Ativos -->
    <div class="cartao">
      <div class="cabecalhoCartao">
        <h3 class="tituloCartao">Produtos Ativos</h3>
        <div class="iconeCartao">
          <img
            src="{{ url_for('static', filename='assets/icons/produto.svg') }}"
            alt="produtos"
          />
        </div>
      </div>
      <div class="valorCartao">{{ total_produtos_ativos }}</div>
      <div class="descricaoCartao">Itens disponíveis no catálogo</div>
    </div>

    <!-- Fornecedores Ativos -->
    <div class="cartao">
      <div class="cabecalhoCartao">
        <h3 class="tituloCartao">
          Fornecedores <br />
          Ativos
        </h3>
        <div class="iconeCartao">
          <img
            src="{{ url_for('static', filename='assets/icons/pessoas.svg') }}"
            alt="fornecedores"
          />
        </div>
      </div>
      <div class="valorCartao">{{ total_fornecedores_ativos }}</div>
      <div class="descricaoCartao">Fornecedores em atividade</div>
    </div>
  </div>

  <!-- Gráficos -->
  <div class="dashboardGrid">
    <div class="graficos">
      <canvas id="chartCategoria"></canvas>
    </div>
    <div class="graficos">
      <canvas id="chartTopProdutos"></canvas>
    </div>
    <div class="graficos">
      <canvas id="chartVendasSemana"></canvas>
    </div>
  </div>
</section>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  function gerarCores(qtd) {
      const cores = [];
      for (let i = 0; i < qtd; i++) {
          const r = Math.floor(Math.random() * 200 + 30);
          const g = Math.floor(Math.random() * 200 + 30);
          const b = Math.floor(Math.random() * 200 + 30);
          cores.push(`rgba(${r}, ${g}, ${b}, 0.7)`);
      }
      return cores;
  }

  const categoriaData = {{ grafico_categoria | safe }};
  const topProdutosData = {{ grafico_top_produtos | safe }};
  const vendasSemanaData = {{ grafico_vendas_semana | safe }};

  // Estoque por Categoria (Doughnut)
  new Chart(document.getElementById('chartCategoria'), {
      type: 'doughnut',
      data: {
          labels: categoriaData.labels,
          datasets: [{ data: categoriaData.values, backgroundColor: gerarCores(categoriaData.labels.length) }]
      },
      options: {
          responsive: true,
          plugins: { title: { display: true, text: 'Valor do Estoque por Categoria', font: { size: 18 } }, legend: { position: 'bottom' } }
      }
  });

  // Top Produtos (Bar)
  new Chart(document.getElementById('chartTopProdutos'), {
      type: 'bar',
      data: {
          labels: topProdutosData.labels,
          datasets: [{ label: 'Valor em R$', data: topProdutosData.values, backgroundColor: gerarCores(topProdutosData.labels.length) }]
      },
      options: {
          responsive: true,
          plugins: { title: { display: true, text: 'Top Produtos por Valor em Estoque', font: { size: 18 } }, legend: { display: false } },
          scales: { y: { beginAtZero: true } }
      }
  });

  // Vendas Semanais (Line)
  new Chart(document.getElementById('chartVendasSemana'), {
      type: 'line',
      data: {
          labels: vendasSemanaData.labels,
          datasets: [{
              label: 'Vendas em R$',
              data: vendasSemanaData.values,
              borderColor: '#36A2EB',
              backgroundColor: 'rgba(54, 162, 235, 0.2)',
              fill: true,
              tension: 0.4,
              pointBackgroundColor: '#36A2EB',
              pointRadius: 5
          }]
      },
      options: {
          responsive: true,
          plugins: { title: { display: true, text: 'Vendas Semanais', font: { size: 18 } } },
          scales: { y: { beginAtZero: true } }
      }
  });
</script>

{% endblock %}
